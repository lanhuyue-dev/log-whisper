<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LogWhisper - 智能日志编辑器 (Tauri)</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Loading 页面 -->
    <div id="loadingOverlay" class="fixed inset-0 bg-gray-50 dark:bg-gray-900 flex items-center justify-center z-50">
        <div class="text-center space-y-6">
            <div class="w-16 h-16 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto"></div>
            <div class="space-y-2">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">LogWhisper</h2>
                <p class="text-gray-600 dark:text-gray-400">正在加载 Tauri 应用...</p>
                <div class="text-sm text-gray-500 dark:text-gray-500" id="loadingStatus">初始化中...</div>
            </div>
        </div>
    </div>

    <!-- 主应用内容 -->
    <div class="h-screen flex flex-col">
        <!-- 顶部工具栏 -->
        <header class="flex items-center justify-between h-12 px-4 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-sm flex-shrink-0">
            <!-- 左侧：应用标题和文件操作 -->
            <div class="flex items-center space-x-4">
                <div class="flex items-center space-x-2">
                    <div class="text-xl">📊</div>
                    <span class="text-lg font-bold text-gray-900 dark:text-white">LogWhisper</span>
                </div>

                <!-- 文件操作 -->
                <div class="flex items-center space-x-2">
                    <button id="uploadBtn" class="inline-flex items-center space-x-1 px-3 py-1.5 text-sm rounded-md font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 bg-primary-600 hover:bg-primary-700 text-white focus:ring-primary-500">
                        <span class="text-sm">📄</span>
                        <span>选择文件</span>
                    </button>
                    <input type="file" id="fileInput" accept=".log,.txt,.json,.csv" class="hidden">
                </div>
            </div>

            <!-- 中间：搜索 -->
            <div class="flex items-center space-x-4 flex-1 max-w-2xl mx-8">
                <!-- 搜索框 -->
                <div class="relative flex-1">
                    <input type="text" id="searchInput" placeholder="搜索日志内容..." class="w-full px-3 py-1.5 pl-8 pr-3 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>
                </div>

                <!-- 快速操作提示 -->
                <div class="text-xs text-gray-500 dark:text-gray-400 hidden lg:block">
                    💡 使用左侧面板进行日志级别过滤
                </div>
            </div>

            <!-- 右侧：工具按钮 -->
            <div class="flex items-center space-x-2">
                <button id="resetBtn" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200" title="重新选择文件">
                    <span class="text-lg">🔄</span>
                </button>
                <button id="exportBtn" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200" title="导出结果">
                    <span class="text-lg">💾</span>
                </button>
                <button id="themeToggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200" title="切换主题">
                    <span class="text-lg">🌙</span>
                </button>
                <button id="settingsBtn" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200" title="设置">
                    <span class="text-lg">⚙️</span>
                </button>
            </div>
        </header>

        <!-- 主编辑区域 -->
        <main class="flex flex-1 bg-gray-50 dark:bg-gray-900 min-h-0">
            <!-- 左侧导航面板 -->
            <aside id="sidebar" class="w-80 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col">
                <!-- 侧边栏标题栏 -->
                <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300">导航面板</h3>
                </div>

                <!-- 侧边栏内容 -->
                <div class="flex-1 overflow-y-auto">
                    <!-- 过滤器 -->
                    <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                        <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">日志级别过滤</h4>
                        <div class="space-y-2">
                            <button class="filter-btn w-full text-left px-3 py-2 text-sm rounded-md bg-blue-500 text-white" data-filter="all">
                                全部
                            </button>
                            <button class="filter-btn w-full text-left px-3 py-2 text-sm rounded-md bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300" data-filter="error">
                                错误 (ERROR)
                            </button>
                            <button class="filter-btn w-full text-left px-3 py-2 text-sm rounded-md bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300" data-filter="warn">
                                警告 (WARN)
                            </button>
                            <button class="filter-btn w-full text-left px-3 py-2 text-sm rounded-md bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300" data-filter="info">
                                信息 (INFO)
                            </button>
                            <button class="filter-btn w-full text-left px-3 py-2 text-sm rounded-md bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300" data-filter="debug">
                                调试 (DEBUG)
                            </button>
                        </div>
                    </div>

                    <!-- 统计信息 -->
                    <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                        <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">统计信息</h4>
                        <div id="sidebarNav" class="space-y-2">
                            <!-- 动态生成统计信息 -->
                        </div>
                    </div>
                </div>
            </aside>

            <!-- 主编辑区 -->
            <div class="flex-1 flex flex-col min-h-0">
                <!-- 欢迎界面 -->
                <div id="welcomeScreen" class="flex-1 flex items-center justify-center p-4">
                    <div class="text-center space-y-4 max-w-lg">
                        <div class="text-5xl">👋</div>
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">欢迎使用 LogWhisper Tauri 版本</h2>
                        <p class="text-gray-600 dark:text-gray-400 text-base mb-6">
                            请点击「选择文件」或拖拽日志文件到此处开始分析
                        </p>

                        <!-- 拖拽区域 -->
                        <div id="dropZone" class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-primary-500 dark:hover:border-primary-400 transition-colors duration-200">
                            <div class="text-4xl mb-4">📁</div>
                            <p class="text-gray-600 dark:text-gray-400 mb-2">拖拽日志文件到此处</p>
                            <p class="text-sm text-gray-500 dark:text-gray-500">或点击上方的「选择文件」按钮</p>
                        </div>

                        <div class="text-left bg-gray-50 dark:bg-gray-800 rounded-lg p-4 mt-6">
                            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">支持的日志格式：</h4>
                            <ul class="space-y-1 text-sm text-gray-600 dark:text-gray-400">
                                <li class="flex items-center space-x-2">
                                    <span class="text-primary-500">•</span>
                                    <span>MyBatis SQL 日志</span>
                                </li>
                                <li class="flex items-center space-x-2">
                                    <span class="text-primary-500">•</span>
                                    <span>Docker JSON 日志</span>
                                </li>
                                <li class="flex items-center space-x-2">
                                    <span class="text-primary-500">•</span>
                                    <span>Spring Boot 应用日志</span>
                                </li>
                                <li class="flex items-center space-x-2">
                                    <span class="text-primary-500">•</span>
                                    <span>通用文本日志</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 日志编辑器 -->
                <div id="logEditor" class="flex-1 flex flex-col hidden">
                    <!-- 编辑器工具栏 -->
                    <div id="editorToolbar" class="flex items-center justify-between p-2 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 hidden">
                        <div class="flex items-center space-x-4">
                            <span class="text-sm text-gray-600 dark:text-gray-400" id="fileInfo">未选择文件</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button id="clearBtn" class="px-3 py-1.5 text-sm rounded-md font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 focus:ring-gray-500">
                                <span class="text-sm">🗑️</span>
                                <span>清空</span>
                            </button>
                        </div>
                    </div>

                    <!-- 日志内容区域 -->
                    <div id="logContent" class="flex-1 overflow-y-auto overflow-x-hidden bg-white dark:bg-gray-900">
                        <div id="logLines" class="font-mono text-sm">
                            <!-- 日志行将在这里渲染 -->
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- 底部状态栏 -->
        <footer id="statusBar" class="h-8 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 flex items-center px-4 text-xs text-gray-600 dark:text-gray-400 flex-shrink-0">
            <div class="flex items-center justify-between w-full">
                <div class="flex items-center space-x-4">
                    <span id="statusLine">行 0/0</span>
                    <span id="statusColumn">列 0</span>
                    <span id="statusPlugins">插件：无</span>
                    <span id="statusSearch">搜索：0 处匹配</span>
                </div>
                <div class="flex items-center space-x-4" id="fileStatusInfo">
                    <span id="statusFile">文件：无</span>
                    <span id="statusFileSize" class="hidden">大小：未知</span>
                    <span id="statusParseTime" class="hidden">解析：未知</span>
                </div>
            </div>
        </footer>
    </div>

    <!-- 加载指示器 -->
    <div id="progressBar" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-8 text-center">
            <div class="w-8 h-8 border-4 border-gray-200 dark:border-gray-600 border-t-primary-600 rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-gray-600 dark:text-gray-400" id="loadingProgress">正在处理...</p>
        </div>
    </div>

    <!-- Tauri API -->
    <script src="https://unpkg.com/@tauri-apps/api@1.0.0/dist/tauri.js"></script>
    <script src="main-tauri.js"></script>
</body>
</html>