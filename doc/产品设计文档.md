# LogWhisper 产品设计文档

## 1. 产品概述

### 1.1 产品定位
LogWhisper 是一款轻量、本地优先、开发者友好的桌面日志分析工具，专注于解决日志分析中的核心痛点。

### 1.2 目标用户
- 后端开发工程师
- 运维工程师  
- 测试工程师
- 需要分析应用日志的技术人员

### 1.3 核心价值主张
- **轻量高效**：无需复杂配置，拖拽即用
- **本地优先**：数据不上传，保护隐私
- **智能解析**：自动修复和格式化日志内容
- **一键复制**：快速获取可执行内容

## 2. 产品功能设计

### 2.1 核心功能架构

```
┌─────────────────────────────────────┐
│            LogWhisper               │
├─────────────────────────────────────┤
│  输入层：文件拖拽/选择/剪贴板          │
├─────────────────────────────────────┤
│  解析层：插件化解析引擎               │
│  ├─ MyBatis SQL 还原                │
│  ├─ JSON 修复与格式化                │
│  └─ 错误关键词识别                   │
├─────────────────────────────────────┤
│  展示层：双栏界面                    │
│  ├─ 左侧：原始日志                   │
│  └─ 右侧：结构化结果                 │
├─────────────────────────────────────┤
│  交互层：复制/过滤/切换               │
└─────────────────────────────────────┘
```

### 2.2 用户界面设计

#### 2.2.1 整体布局
```
┌─────────────────────────────────────────────────────────────┐
│  LogWhisper v1.0                                    [×] [-]  │
├─────────────────────────────────────────────────────────────┤
│  文件: [选择文件] [拖拽区域]    插件: [Auto ▼] 过滤: [搜索框]  │
├─────────────────────────────────────────────────────────────┤
│  原始日志 (左侧)              │  解析结果 (右侧)              │
│  ┌─────────────────────────┐  │  ┌─────────────────────────┐  │
│  │ 2024-01-01 10:00:00    │  │  │ 🔍 SQL 查询              │  │
│  │ Preparing: SELECT...   │  │  │ ┌─────────────────────┐  │  │
│  │ Parameters: 123, "张三"│  │  │ │ SELECT * FROM user  │  │  │
│  │                        │  │  │ │ WHERE id = 123     │  │  │
│  │ 2024-01-01 10:00:01    │  │  │ │ AND name = '张三'   │  │  │
│  │ {"name":"张三","age":25}│  │  │ └─────────────────────┘  │  │
│  │                        │  │  │ [复制] [格式化]          │  │
│  │                        │  │  │                        │  │
│  │                        │  │  │ 📄 JSON 数据            │  │
│  │                        │  │  │ ┌─────────────────────┐  │  │
│  │                        │  │  │ │ {                  │  │  │
│  │                        │  │  │ │   "name": "张三",   │  │  │
│  │                        │  │  │ │   "age": 25        │  │  │
│  │                        │  │  │ │ }                  │  │  │
│  │                        │  │  │ └─────────────────────┘  │  │
│  │                        │  │  │ [复制] [美化]            │  │
│  └─────────────────────────┘  │  └─────────────────────────┘  │
├─────────────────────────────────────────────────────────────┤
│  状态栏: 已加载 1,234 行 | 解析耗时 0.5s | 错误: 3 个        │
└─────────────────────────────────────────────────────────────┘
```

#### 2.2.2 关键界面元素

**顶部工具栏**
- 文件选择按钮：支持拖拽和点击选择
- 插件切换下拉框：Auto/MyBatis/JSON/Raw
- 搜索过滤框：实时过滤日志行
- 清空按钮：重置当前文件

**双栏布局**
- 左侧面板：原始日志内容，保持原始格式
- 右侧面板：结构化解析结果，支持多种渲染块

**渲染块设计**
- SQL 块：绿色主题，语法高亮
- JSON 块：蓝色主题，格式化缩进
- 错误块：红色主题，醒目提示
- 普通文本：灰色主题，保持可读性

### 2.3 用户交互流程

#### 2.3.1 主要使用流程
```
1. 启动应用 (≤2秒)
   ↓
2. 拖拽日志文件到窗口
   ↓
3. 自动解析并显示双栏界面
   ↓
4. 选择解析插件（如需要）
   ↓
5. 浏览解析结果，点击复制按钮
   ↓
6. 完成分析任务
```

#### 2.3.2 详细交互设计

**文件导入流程**
1. 用户拖拽文件到窗口区域
2. 显示加载动画和进度条
3. 后台解析（≤3秒）
4. 显示解析结果和统计信息

**插件切换流程**
1. 用户点击插件下拉框
2. 选择目标插件（Auto/MyBatis/JSON/Raw）
3. 右侧面板重新渲染
4. 显示切换后的结果

**复制操作流程**
1. 用户点击渲染块旁的"复制"按钮
2. 内容复制到剪贴板
3. 显示"已复制"提示
4. 用户可在其他应用中粘贴

### 2.4 视觉设计规范

#### 2.4.1 色彩方案
- **主色调**：深蓝色 (#1e3a8a)
- **成功色**：绿色 (#10b981)
- **警告色**：橙色 (#f59e0b)
- **错误色**：红色 (#ef4444)
- **背景色**：浅灰色 (#f8fafc)
- **文本色**：深灰色 (#374151)

#### 2.4.2 字体规范
- **主字体**：系统默认字体（Windows: Segoe UI）
- **代码字体**：Consolas 或 Monaco
- **标题字号**：16px
- **正文字号**：14px
- **代码字号**：13px

#### 2.4.3 图标设计
- **文件图标**：📄
- **SQL 图标**：🔍
- **JSON 图标**：📄
- **错误图标**：⚠️
- **复制图标**：📋
- **设置图标**：⚙️

## 3. 功能详细设计

### 3.1 日志输入功能

#### 3.1.1 文件拖拽
- **支持格式**：.log, .txt
- **文件大小限制**：≤50MB
- **拖拽区域**：整个窗口区域
- **视觉反馈**：拖拽时高亮边框

#### 3.1.2 文件选择
- **按钮位置**：顶部工具栏左侧
- **文件对话框**：系统原生文件选择器
- **多选支持**：暂不支持（V1版本）

#### 3.1.3 剪贴板粘贴
- **触发方式**：Ctrl+V 快捷键
- **支持格式**：纯文本
- **大小限制**：≤10MB

### 3.2 解析引擎功能

#### 3.2.1 MyBatis SQL 还原
**输入示例**：
```
Preparing: SELECT * FROM user WHERE id = ? AND name = ?
Parameters: 123(Integer), "张三"(String)
```

**输出结果**：
```sql
SELECT * FROM user WHERE id = 123 AND name = '张三'
```

**特性**：
- 自动处理字符串加单引号
- 数值类型不加引号
- 支持多行合并
- 状态机缓存处理

#### 3.2.2 JSON 修复与格式化
**修复能力**：
- 缺少逗号：`{"a":1 "b":2}` → `{"a":1, "b":2}`
- 未闭合括号：`{"a":1` → `{"a":1}`
- 引号缺失：`{name:张三}` → `{"name":"张三"}`
- 嵌套JSON字符串：`"{\"a\":1}"` → 正确解析

**输出格式**：
- 自动缩进美化
- 保留原始语义
- 语法高亮显示

#### 3.2.3 错误关键词识别
**识别关键词**：
- ERROR, WARN, Exception
- 500, timeout, null, failed
- 自定义关键词（V2版本）

**高亮效果**：
- 错误行：红色背景
- 警告行：橙色背景
- 普通行：默认背景

### 3.3 界面交互功能

#### 3.3.1 双栏布局
- **左侧面板**：原始日志，不可编辑
- **右侧面板**：解析结果，支持交互
- **同步滚动**：两侧面板同步滚动
- **独立滚动**：支持独立滚动查看

#### 3.3.2 渲染块交互
- **点击选择**：点击渲染块显示详细信息
- **复制按钮**：每个块提供复制功能
- **格式化按钮**：JSON块提供美化功能
- **展开/折叠**：长内容支持折叠显示

#### 3.3.3 搜索过滤
- **实时搜索**：输入即过滤
- **关键词高亮**：搜索结果高亮显示
- **清除过滤**：一键清除过滤条件
- **正则支持**：V2版本支持正则表达式

## 4. 用户体验设计

### 4.1 性能要求
- **启动速度**：≤2秒（空窗口）
- **解析速度**：≤3秒（50MB文件）
- **响应速度**：≤100ms（界面操作）
- **内存占用**：≤200MB（50MB文件）

### 4.2 错误处理
- **文件过大**：提示"文件过大，请使用专业工具"
- **解析失败**：显示错误信息和建议
- **格式不支持**：提示支持的格式类型
- **内存不足**：提示关闭其他应用

### 4.3 用户引导
- **首次使用**：显示功能介绍弹窗
- **操作提示**：关键操作提供工具提示
- **状态反馈**：操作结果及时反馈
- **帮助文档**：内置使用说明

## 5. 产品迭代规划

### 5.1 MVP版本（V1.0）
- 基础文件导入功能
- 双栏界面展示
- MyBatis和JSON解析
- 基础复制功能

### 5.2 增强版本（V1.1）
- 性能优化
- 更多解析插件
- 快捷键支持
- 主题切换

### 5.3 扩展版本（V2.0）
- 多文件支持
- 自定义插件
- 高级搜索
- 导出功能

## 6. 成功指标

### 6.1 功能指标
- 用户能在10秒内完成完整操作流程
- 解析准确率≥95%
- 复制功能成功率100%

### 6.2 性能指标
- 启动时间≤2秒
- 解析时间≤3秒（50MB文件）
- 内存占用≤200MB

### 6.3 用户满意度
- 用户愿意推荐给同事
- 用户反馈"这比我手动修快多了！"
- 用户留存率≥80%

---

**文档版本**：v1.0  
**创建日期**：2024年1月  
**最后更新**：2024年1月
