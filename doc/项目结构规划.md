# LogWhisper 项目结构规划

## 1. 项目整体结构

```
log-whisper/
├── doc/                          # 文档目录
│   ├── 需求.md                   # 产品需求文档
│   ├── 产品设计文档.md            # UI/UX设计文档
│   ├── 技术方案文档.md            # 技术架构文档
│   ├── 项目结构规划.md            # 本文档
│   ├── API文档.md                # API接口文档
│   └── 部署指南.md               # 部署和发布指南
├── src/                          # 前端源码目录
│   ├── index.html                # 主页面
│   ├── style.css                 # 样式文件
│   ├── main.js                   # 前端逻辑
│   └── assets/                   # 静态资源
│       ├── icons/                # 图标文件
│       └── images/               # 图片文件
├── src-tauri/                    # Tauri后端目录
│   ├── src/                      # Rust源码
│   │   ├── main.rs              # 应用入口
│   │   ├── lib.rs               # 库入口
│   │   ├── models/              # 数据模型
│   │   │   ├── mod.rs
│   │   │   ├── log_entry.rs     # 日志条目模型
│   │   │   ├── rendered_block.rs # 渲染块模型
│   │   │   └── plugin_config.rs # 插件配置模型
│   │   ├── plugins/             # 插件系统
│   │   │   ├── mod.rs
│   │   │   ├── trait.rs         # LogRenderer trait
│   │   │   ├── mybatis.rs       # MyBatis解析插件
│   │   │   ├── json_repair.rs   # JSON修复插件
│   │   │   ├── error_highlighter.rs # 错误高亮插件
│   │   │   └── raw.rs           # 原始文本插件
│   │   ├── parser/              # 解析引擎
│   │   │   ├── mod.rs
│   │   │   ├── log_parser.rs    # 主解析器
│   │   │   ├── file_reader.rs   # 文件读取器
│   │   │   └── renderer.rs      # 渲染引擎
│   │   ├── tauri/               # Tauri集成
│   │   │   ├── mod.rs
│   │   │   ├── commands.rs      # Tauri命令
│   │   │   └── handlers.rs      # 事件处理器
│   │   └── utils/               # 工具函数
│   │       ├── mod.rs
│   │       ├── file_utils.rs    # 文件操作工具
│   │       └── string_utils.rs  # 字符串处理工具
│   ├── Cargo.toml               # Rust依赖配置
│   ├── tauri.conf.json          # Tauri配置文件
│   └── build.rs                 # 构建脚本
├── tests/                       # 测试目录
│   ├── integration/             # 集成测试
│   │   ├── mod.rs
│   │   └── parse_workflow_test.rs
│   └── fixtures/                # 测试数据
│       ├── sample.log           # 示例日志文件
│       ├── mybatis.log          # MyBatis日志示例
│       └── json.log             # JSON日志示例
├── scripts/                     # 构建和部署脚本
│   ├── build.sh                 # 构建脚本
│   ├── test.sh                  # 测试脚本
│   └── release.sh               # 发布脚本
├── .github/                     # GitHub Actions
│   └── workflows/
│       ├── ci.yml               # 持续集成
│       └── release.yml          # 发布流程
├── .gitignore                   # Git忽略文件
├── Cargo.toml                   # 项目根配置
├── README.md                    # 项目说明
├── CHANGELOG.md                 # 更新日志
└── LICENSE                      # 许可证
```

## 2. 核心模块详细结构

### 2.1 数据模型层 (models/)

```
models/
├── mod.rs                       # 模块导出
├── log_entry.rs                 # 日志条目定义
│   ├── LogEntry                 # 基础日志条目
│   ├── LogLevel                 # 日志级别枚举
│   └── LogTimestamp             # 时间戳处理
├── rendered_block.rs            # 渲染块定义
│   ├── RenderedBlock            # 渲染块结构
│   ├── BlockType                # 块类型枚举
│   └── BlockMetadata            # 块元数据
├── plugin_config.rs             # 插件配置
│   ├── PluginConfig             # 插件配置结构
│   ├── PluginPriority           # 插件优先级
│   └── PluginSettings           # 插件设置
└── parse_result.rs              # 解析结果
    ├── ParseResult              # 解析结果结构
    ├── ParseError               # 解析错误类型
    └── ParseStats               # 解析统计信息
```

### 2.2 插件系统 (plugins/)

```
plugins/
├── mod.rs                       # 插件模块导出
├── trait.rs                     # 插件Trait定义
│   ├── LogRenderer              # 核心渲染Trait
│   ├── PluginLifecycle          # 插件生命周期
│   └── PluginCapabilities       # 插件能力接口
├── mybatis.rs                   # MyBatis解析插件
│   ├── MyBatisRenderer          # MyBatis渲染器
│   ├── SqlExtractor             # SQL提取器
│   ├── ParameterParser          # 参数解析器
│   └── SqlFormatter             # SQL格式化器
├── json_repair.rs               # JSON修复插件
│   ├── JsonRepairRenderer       # JSON修复渲染器
│   ├── JsonValidator            # JSON验证器
│   ├── JsonFixer                # JSON修复器
│   └── JsonFormatter            # JSON格式化器
├── error_highlighter.rs         # 错误高亮插件
│   ├── ErrorHighlighter        # 错误高亮器
│   ├── ErrorPattern             # 错误模式匹配
│   └── HighlightConfig          # 高亮配置
├── raw.rs                       # 原始文本插件
│   ├── RawRenderer              # 原始文本渲染器
│   └── TextFormatter            # 文本格式化器
└── registry.rs                  # 插件注册中心
    ├── PluginRegistry           # 插件注册表
    ├── PluginLoader             # 插件加载器
    └── PluginManager             # 插件管理器
```

### 2.3 解析引擎 (parser/)

```
parser/
├── mod.rs                       # 解析模块导出
├── log_parser.rs                # 主解析器
│   ├── LogParser                # 日志解析器
│   ├── ParseStrategy            # 解析策略
│   └── ParseContext             # 解析上下文
├── file_reader.rs               # 文件读取器
│   ├── FileReader               # 文件读取器
│   ├── StreamingReader          # 流式读取器
│   └── FileValidator            # 文件验证器
├── renderer.rs                  # 渲染引擎
│   ├── RenderEngine             # 渲染引擎
│   ├── RenderPipeline           # 渲染管道
│   └── RenderOptimizer          # 渲染优化器
├── line_parser.rs               # 行解析器
│   ├── LineParser               # 行解析器
│   ├── TimestampExtractor       # 时间戳提取器
│   └── LogLevelDetector         # 日志级别检测器
└── cache.rs                     # 解析缓存
    ├── ParseCache               # 解析缓存
    ├── CacheStrategy            # 缓存策略
    └── CacheManager             # 缓存管理器
```

### 2.4 Tauri集成 (tauri/)

```
tauri/
├── mod.rs                       # Tauri模块导出
├── commands.rs                  # Tauri命令定义
│   ├── parse_file               # 解析文件命令
│   ├── get_plugins              # 获取插件列表
│   ├── switch_plugin            # 切换插件
│   └── copy_to_clipboard        # 复制到剪贴板
├── handlers.rs                  # 事件处理器
│   ├── FileDropHandler          # 文件拖拽处理
│   ├── PluginChangeHandler      # 插件切换处理
│   └── SearchHandler            # 搜索处理
├── state.rs                     # 应用状态管理
│   ├── AppState                 # 应用状态
│   ├── ParseState               # 解析状态
│   └── UISate                   # UI状态
└── events.rs                    # 事件定义
    ├── ParseEvent               # 解析事件
    ├── UIEvent                  # UI事件
    └── ErrorEvent               # 错误事件
```

### 2.5 工具函数 (utils/)

```
utils/
├── mod.rs                       # 工具模块导出
├── file_utils.rs                # 文件操作工具
│   ├── FileValidator            # 文件验证
│   ├── FileReader               # 文件读取
│   └── FileWatcher              # 文件监控
├── string_utils.rs              # 字符串处理工具
│   ├── StringCleaner            # 字符串清理
│   ├── StringFormatter          # 字符串格式化
│   └── StringMatcher            # 字符串匹配
├── time_utils.rs                # 时间处理工具
│   ├── TimeParser               # 时间解析
│   ├── TimeFormatter            # 时间格式化
│   └── TimeValidator            # 时间验证
└── performance.rs               # 性能工具
    ├── PerformanceMonitor       # 性能监控
    ├── MemoryTracker            # 内存跟踪
    └── Profiler                 # 性能分析器
```

## 3. 前端结构设计

### 3.1 HTML结构

```
src/
├── index.html                   # 主页面
│   ├── 顶部工具栏
│   │   ├── 文件选择按钮
│   │   ├── 插件切换下拉框
│   │   ├── 搜索输入框
│   │   └── 设置按钮
│   ├── 主内容区域
│   │   ├── 左侧原始日志面板
│   │   └── 右侧解析结果面板
│   └── 底部状态栏
├── style.css                    # 样式文件
│   ├── 基础样式
│   ├── 组件样式
│   ├── 主题样式
│   └── 响应式样式
└── main.js                      # 前端逻辑
    ├── 应用初始化
    ├── 事件处理
    ├── UI更新
    └── Tauri通信
```

### 3.2 组件设计

```
components/
├── FileDropZone                 # 文件拖拽区域
├── LogViewer                    # 日志查看器
├── ParsedViewer                 # 解析结果查看器
├── PluginSelector               # 插件选择器
├── SearchBox                    # 搜索框
├── StatusBar                    # 状态栏
├── BlockRenderer                # 块渲染器
│   ├── SqlBlock                 # SQL块
│   ├── JsonBlock                # JSON块
│   ├── ErrorBlock               # 错误块
│   └── RawBlock                 # 原始块
└── CopyButton                   # 复制按钮
```

## 4. 测试结构设计

### 4.1 单元测试

```
tests/
├── unit/                        # 单元测试
│   ├── models/                  # 模型测试
│   │   ├── log_entry_test.rs
│   │   └── rendered_block_test.rs
│   ├── plugins/                 # 插件测试
│   │   ├── mybatis_test.rs
│   │   ├── json_repair_test.rs
│   │   └── error_highlighter_test.rs
│   ├── parser/                  # 解析器测试
│   │   ├── log_parser_test.rs
│   │   └── file_reader_test.rs
│   └── utils/                   # 工具测试
│       ├── file_utils_test.rs
│       └── string_utils_test.rs
```

### 4.2 集成测试

```
tests/
├── integration/                 # 集成测试
│   ├── parse_workflow_test.rs   # 解析工作流测试
│   ├── plugin_integration_test.rs # 插件集成测试
│   └── tauri_integration_test.rs # Tauri集成测试
```

### 4.3 测试数据

```
tests/
├── fixtures/                    # 测试数据
│   ├── sample.log               # 示例日志
│   ├── mybatis.log              # MyBatis日志
│   ├── json.log                 # JSON日志
│   ├── error.log                # 错误日志
│   └── large.log                # 大文件日志
```

## 5. 构建和部署结构

### 5.1 构建配置

```
scripts/
├── build.sh                     # 构建脚本
│   ├── 环境检查
│   ├── 依赖安装
│   ├── 代码编译
│   └── 打包生成
├── test.sh                      # 测试脚本
│   ├── 单元测试
│   ├── 集成测试
│   └── 性能测试
└── release.sh                   # 发布脚本
    ├── 版本更新
    ├── 构建打包
    └── 发布上传
```

### 5.2 CI/CD配置

```
.github/
└── workflows/
    ├── ci.yml                   # 持续集成
    │   ├── 代码检查
    │   ├── 单元测试
    │   ├── 集成测试
    │   └── 构建验证
    └── release.yml              # 发布流程
        ├── 版本构建
        ├── 测试验证
        └── 自动发布
```

## 6. 开发环境配置

### 6.1 开发工具配置

```
.vscode/                         # VS Code配置
├── settings.json                # 编辑器设置
├── launch.json                  # 调试配置
└── extensions.json              # 推荐扩展

.idea/                           # IntelliJ配置
├── workspace.xml                # 工作空间配置
└── modules.xml                  # 模块配置
```

### 6.2 环境配置文件

```
.env.example                     # 环境变量示例
.env.local                       # 本地环境变量
.env.development                 # 开发环境变量
.env.production                  # 生产环境变量
```

## 7. 文档结构

### 7.1 技术文档

```
doc/
├── 需求.md                      # 产品需求
├── 产品设计文档.md               # UI/UX设计
├── 技术方案文档.md               # 技术架构
├── 项目结构规划.md               # 项目结构
├── API文档.md                   # API接口文档
├── 部署指南.md                  # 部署指南
└── 开发指南.md                  # 开发指南
```

### 7.2 用户文档

```
docs/
├── README.md                    # 项目说明
├── INSTALL.md                   # 安装指南
├── USER_GUIDE.md                # 用户指南
├── FAQ.md                       # 常见问题
└── CHANGELOG.md                 # 更新日志
```

## 8. 代码组织原则

### 8.1 模块化设计
- **单一职责**：每个模块只负责一个功能
- **低耦合**：模块间依赖最小化
- **高内聚**：模块内部功能紧密相关

### 8.2 命名规范
- **文件命名**：使用snake_case
- **结构体命名**：使用PascalCase
- **函数命名**：使用snake_case
- **常量命名**：使用UPPER_SNAKE_CASE

### 8.3 代码结构
- **导入顺序**：标准库 → 第三方库 → 本地模块
- **函数顺序**：公共函数 → 私有函数
- **注释规范**：使用文档注释 `///`

### 8.4 错误处理
- **统一错误类型**：使用thiserror定义错误
- **错误传播**：使用?操作符
- **错误日志**：记录详细的错误信息

## 9. 性能考虑

### 9.1 内存管理
- **流式处理**：大文件分块处理
- **缓存策略**：合理使用缓存
- **内存监控**：监控内存使用情况

### 9.2 并发处理
- **异步处理**：使用tokio异步运行时
- **线程池**：合理使用线程池
- **锁机制**：避免死锁和竞争

### 9.3 性能优化
- **算法优化**：选择高效的算法
- **数据结构**：使用合适的数据结构
- **缓存机制**：实现智能缓存

## 10. 安全考虑

### 10.1 输入验证
- **文件类型**：验证文件类型和大小
- **内容检查**：检查文件内容安全性
- **路径安全**：防止路径遍历攻击

### 10.2 权限控制
- **文件权限**：限制文件访问权限
- **系统调用**：限制系统调用范围
- **网络访问**：禁用不必要的网络访问

### 10.3 数据保护
- **本地存储**：数据不离开本地
- **内存清理**：及时清理敏感数据
- **日志安全**：避免记录敏感信息

---

**文档版本**：v1.0  
**创建日期**：2024年1月  
**最后更新**：2024年1月
