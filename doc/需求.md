LogWhisper 桌面端日志分析工具
MVP 版本功能清单与技术方案（v1.0）
一、项目目标
打造一款轻量、本地优先、开发者友好的桌面日志分析工具，聚焦解决以下核心痛点：

MyBatis 日志中 SQL 与参数分离，难以直接复现
日志中嵌套的 JSON 字符串格式混乱、语法错误、难以阅读
错误日志淹没在海量文本中，定位效率低
MVP 核心价值：用户拖入日志文件后，左侧保留原始内容，右侧自动呈现结构化、修复后、高亮的关键信息，支持一键复制可执行内容。

✅ 不追求大而全，只做“小而美 + 高频刚需”
✅ GB 级日志支持为低优先级（V2+ 考虑） 

二、MVP 功能清单
1. 日志输入（简单直接）
文件拖拽导入
支持拖拽
.log
/
.txt
文件到窗口（Windows）
高
“Open File” 按钮
通过系统文件选择器打开日志文件
高
剪贴板粘贴
支持从剪贴板粘贴日志文本（可选，V1 可简化）
中

限制：单文件 ≤ 50 MB（约 30~50 万行），超限提示“文件过大，请使用专业工具” 

2. 双栏渲染界面（核心交互）
左侧：原始日志面板
完整展示原始日志内容，不可编辑，保留原始格式
右侧：渲染结果面板
按行展示结构化解析结果，每行可包含多个“渲染块”（如 SQL + JSON）
渲染块样式
每个块带图标、标题、美化内容（如语法高亮 SQL、缩进 JSON）
错误高亮
ERROR/WARN/Exception 行在右侧自动标红/标黄

3. 内置解析插件（可切换）
用户可通过底部下拉菜单选择渲染模式：

Auto（默认）
自动选择最佳插件组合
全局默认
MyBatis
仅显示 MyBatis SQL 还原结果
日志含
Preparing:
/
Parameters:
JSON
仅显示修复并格式化的 JSON
日志含
{
和
}
Raw
右侧等同于左侧（纯文本）
调试/对比用

✅ 插件架构为 Rust trait 实现，便于未来扩展（如 Nginx、K8s） 

4. 核心解析能力
4.1 MyBatis 日志参数还原
输入示例：


1
2
Preparing: SELECT * FROM user WHERE id = ? AND name = ?
Parameters: 123(Integer), "张三"(String)
输出结果：
sql


1
SELECT * FROM user WHERE id = 123 AND name = '张三'
特性：
自动处理字符串加单引号
数值类型不加引号
支持多行合并（状态机缓存）
4.2 JSON 自动修复与格式化
支持修复：
缺少逗号（{"a":1 "b":2} → {"a":1, "b":2}）
未闭合括号（{"a":1 → {"a":1}）
引号缺失（{name:张三} → {"name":"张三"}）
嵌套 JSON 字符串（"{\"a\":1}" → 正确解析为对象）
输出：自动缩进美化，保留原始语义
4.3 错误关键词识别
高亮关键词：ERROR, WARN, Exception, 500, timeout, null, failed
效果：右侧渲染块背景色变化（红/橙），便于快速扫描
5. 交互与导出
点击渲染块
底部显示该行原始内容（用于对比）
“Copy” 按钮
每个 SQL/JSON 块旁提供“复制”按钮
关键词过滤
顶部输入框实时过滤日志行（前端实现）
启动速度
≤ 2 秒（空窗口）
解析速度
≤ 3 秒（50MB 文件，后台线程）

6. 打包与分发（Windows 优先）
输出格式
单文件
.exe
（无外部依赖）
安装方式
MSI 安装包 + 便携版 ZIP
体积控制
≤ 20 MB
运行环境
无需安装 .NET / JRE / Python

三、明确排除的功能（V1 不做）
自然语言问答（AI）
非核心，增加复杂度
日志聚类/摘要
需算法，MVP 聚焦“解析”而非“分析”
实时日志监听
需后台服务，偏离“一次性分析”场景
多文件对比
使用频率低
图表可视化
属于监控范畴
GB 级日志支持
性能优化成本高，留待 V2
macOS / Linux 支持
Windows 优先，其他平台 V2 考虑
用户自定义插件
MVP 使用内置插件，架构预留扩展点

四、技术方案
1. 整体架构


1
2
3
4
5
6
7
8
9
10
11
12
13
14
┌───────────────────────────────────────┐
│             前端（极简）               │
│  - HTML + Tailwind CSS (CDN)          │
│  - 双栏布局 + 插件切换下拉框          │
│  - 调用 Rust 命令 + 渲染结果          │
└───────────────┬───────────────────────┘
                │ Tauri Bridge
┌───────────────▼───────────────────────┐
│             后端（Rust）               │
│  - 日志解析引擎                       │
│  - 插件化渲染器（trait）              │
│  - MyBatis 合并 + JSON 修复           │
│  - 后台线程处理大文件                 │
└───────────────────────────────────────┘
2. 技术栈选型
核心语言
Rust
内存安全、高性能、编译为原生
桌面框架
Tauri 1.6+
轻量（vs Electron）、安全、Rust 优先
前端
Vanilla HTML + JS + Tailwind CSS (CDN)
无需构建，代码 < 200 行
JSON 处理
serde_json
官方推荐，支持自定义反序列化
正则引擎
regex
crate
高性能，支持 Unicode
时间解析
chrono
解析常见日志时间格式
打包工具
tauri build
生成 Windows MSI / EXE

3. 关键 Rust 模块设计
models.rs：定义 ParsedLogEntry、RenderedBlock 等数据结构
plugins/ 目录：
mod.rs：定义 LogRenderer trait
mybatis.rs：MyBatis 参数还原插件
json_repair.rs：JSON 修复插件
renderer.rs：渲染引擎，路由到合适插件
log_parser.rs：文件级解析入口，调用渲染引擎
4. 性能策略
后台解析：使用 std::thread 或 tokio 避免 UI 卡顿
内存控制：逐行解析，不全量加载到内存（50MB 内可行）
懒渲染：前端仅渲染可视区域（MVP 可简化为全量渲染）
5. 插件化设计原则
所有解析器实现 LogRenderer trait
渲染引擎自动遍历插件，选择 can_handle() 为 true 的执行
新插件只需实现 trait 并注册到引擎，无需修改核心逻辑
五、开发与交付计划
Week 1
完成核心 Rust 解析器（MyBatis + JSON 修复） + Tauri 基础框架
5 天
Week 2
实现双栏前端 + 插件切换 + 打包测试（Windows）
5 天
Week 3
优化体验（加载提示、错误处理、快捷键） + 发布测试版
3 天

交付物：Windows .exe + .msi 安装包，支持直接运行 

六、成功标准
用户能在 10 秒内完成以下操作闭环：

拖入一个包含 MyBatis 和 JSON 的日志文件
在右侧看到：
还原后的可执行 SQL
修复并格式化的 JSON
ERROR 行高亮
点击“Copy”按钮，将 SQL 或 JSON 复制到剪贴板
✅ “这比我手动修快多了！” —— 用户愿意推荐给同事 

文档版本：v1.0